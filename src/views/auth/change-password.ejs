<div class="max-w-2xl mx-auto">
  <div class="bg-white p-8 rounded-lg shadow">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">
      <i class="fas fa-key"></i> Change Password
    </h1>

    <% if (locals.isForced) { %>
      <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-4">
        <i class="fas fa-info-circle"></i> You must change your password before continuing.
      </div>
    <% } %>

    <% if (message && message.length > 0) { %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        <%= message[0] %>
      </div>
    <% } %>

    <% if (success && success.length > 0) { %>
      <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
        <%= success[0] %>
      </div>
    <% } %>

    <form action="/auth/change-password" method="POST" class="space-y-6">
      <% if (!locals.isForced) { %>
      <div>
        <label class="block text-gray-700 mb-2" for="currentPassword">
          <i class="fas fa-lock"></i> Current Password
        </label>
        <input 
          type="password" 
          id="currentPassword" 
          name="currentPassword" 
          required
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Enter current password"
        >
      </div>
      <% } %>

      <div>
        <label class="block text-gray-700 mb-2" for="newPassword">
          <i class="fas fa-key"></i> New Password
        </label>
        <input 
          type="password" 
          id="newPassword" 
          name="newPassword" 
          required
          minlength="6"
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Enter new password"
        >
        <p class="text-sm text-gray-500 mt-1">Minimum 6 characters</p>
      </div>

      <div>
        <label class="block text-gray-700 mb-2" for="confirmPassword">
          <i class="fas fa-check"></i> Confirm New Password
        </label>
        <input 
          type="password" 
          id="confirmPassword" 
          name="confirmPassword" 
          required
          minlength="6"
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Confirm new password"
        >
      </div>

      <div class="flex space-x-4 pt-4">
        <button 
          type="submit"
          class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition"
        >
          <i class="fas fa-save"></i> Change Password
        </button>
        <% if (!locals.isForced) { %>
        <a 
          href="/dashboard" 
          class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition"
        >
          <i class="fas fa-times"></i> Cancel
        </a>
        <% } else { %>
        <a 
          href="/auth/logout" 
          class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition"
        >
          <i class="fas fa-sign-out-alt"></i> Logout
        </a>
        <% } %>
      </div>
    </form>

    <% if (user && !user.mfa_enabled) { %>
      <div class="mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
        <h3 class="font-semibold text-yellow-800 mb-2">
          <i class="fas fa-shield-alt"></i> Security Recommendation
        </h3>
        <p class="text-sm text-yellow-700 mb-3">
          Enable Multi-Factor Authentication (MFA) for better security.
        </p>
        <a 
          href="/auth/mfa-setup" 
          class="inline-block bg-yellow-600 text-white px-4 py-2 rounded text-sm hover:bg-yellow-700"
        >
          <i class="fas fa-lock"></i> Setup MFA
        </a>
      </div>
    <% } %>
  </div>
</div>

<script>
  // Client-side validation
  document.querySelector('form').addEventListener('submit', function(e) {
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    if (newPassword !== confirmPassword) {
      e.preventDefault();
      alert('New passwords do not match!');
      return false;
    }

    if (newPassword.length < 6) {
      e.preventDefault();
      alert('Password must be at least 6 characters long!');
      return false;
    }
  });
</script>
