<div class="max-w-7xl mx-auto">
  <!-- Header -->
  <div class="mb-6">
    <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-4">
      <div class="flex-1">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">
          <i class="fas fa-folder-open text-yellow-500"></i> <%= folder.name %>
        </h1>
        <% if (folder.description) { %>
          <p class="text-gray-600"><%= folder.description %></p>
        <% } %>
      </div>
      <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
        <% if (folder.source_folder_id) { %>
          <!-- Cloned folder: Show Update button -->
          <form action="/shares/folders/<%= folder.id %>/update-from-source" method="POST" onsubmit="return confirm('This will replace all sets and flashcards with the latest from source. Your learning progress will be kept. Continue?');" class="w-full sm:w-auto">
            <button type="submit" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition">
              <i class="fas fa-sync"></i> <span>Update</span>
            </button>
          </form>
        <% } else { %>
          <!-- Original folder: Show Edit and Manage Sets buttons -->
          <a href="/folders/<%= folder.id %>/manage-sets" class="w-full sm:w-auto text-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
            <i class="fas fa-layer-group"></i> <span class="hidden md:inline">Manage</span>
          </a>
          <a href="/folders/<%= folder.id %>/edit" class="w-full sm:w-auto text-center bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition">
            <i class="fas fa-edit"></i> <span class="hidden md:inline">Edit</span>
          </a>
        <% } %>
        <a href="/shares/folders/<%= folder.id %>/share" class="w-full sm:w-auto text-center bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
          <i class="fas fa-share-alt"></i> <span class="hidden md:inline">Share</span>
        </a>
        <form action="/folders/<%= folder.id %>/delete" method="POST" class="w-full sm:w-auto">
          <button 
            type="submit" 
            class="w-full bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition"
            onclick="return confirm('Are you sure? This will NOT delete the sets inside, just remove them from this folder.')"
          >
            <i class="fas fa-trash"></i> <span class="hidden md:inline">Delete</span>
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Stats -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    <div class="bg-white p-4 rounded-lg shadow">
      <p class="text-gray-600 text-sm">Total Cards</p>
      <p class="text-2xl font-bold text-gray-800"><%= flashcards.length %></p>
    </div>
    <div class="bg-white p-4 rounded-lg shadow">
      <p class="text-gray-600 text-sm">Mastered</p>
      <p class="text-2xl font-bold text-green-600"><%= stats.mastered || 0 %></p>
    </div>
    <div class="bg-white p-4 rounded-lg shadow">
      <p class="text-gray-600 text-sm">Learning</p>
      <p class="text-2xl font-bold text-yellow-600"><%= stats.learning || 0 %></p>
    </div>
    <div class="bg-white p-4 rounded-lg shadow">
      <p class="text-gray-600 text-sm">New</p>
      <p class="text-2xl font-bold text-blue-600"><%= flashcards.length - (stats.mastered || 0) - (stats.learning || 0) %></p>
    </div>
  </div>

  <!-- Study Options -->
  <div class="bg-white p-6 rounded-lg shadow mb-6">
    <h2 class="text-xl font-bold text-gray-800 mb-4">
      <i class="fas fa-bolt text-yellow-500"></i> Study Options
    </h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
      <a href="/folders/<%= folder.id %>/study" class="bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition text-center">
        <i class="fas fa-brain"></i> Long-term Learning
      </a>
      <a href="/folders/<%= folder.id %>/random?type=all" class="bg-green-500 text-white px-4 py-3 rounded-lg hover:bg-green-600 transition text-center">
        <i class="fas fa-random"></i> Random All
      </a>
      <a href="/folders/<%= folder.id %>/random?type=starred" class="bg-purple-500 text-white px-4 py-3 rounded-lg hover:bg-purple-600 transition text-center">
        <i class="fas fa-star"></i> Random Starred
      </a>
    </div>
  </div>

  <!-- Sets in Folder -->
  <div class="bg-white p-6 rounded-lg shadow">
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-4">
      <h2 class="text-xl font-bold text-gray-800">
        <i class="fas fa-layer-group text-blue-500"></i> Sets (<%= sets.length %>)
      </h2>
      <% if (!folder.source_folder_id) { %>
        <a href="/folders/<%= folder.id %>/manage-sets" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm text-center">
          <i class="fas fa-plus"></i> Manage Sets
        </a>
      <% } %>
    </div>

  <% if (sets.length === 0) { %>
    <!-- Empty State -->
    <div class="text-center py-8">
      <i class="fas fa-layer-group text-6xl text-gray-300 mb-4"></i>
      <h3 class="text-xl font-bold text-gray-800 mb-2">No sets in this folder yet</h3>
      <p class="text-gray-600 mb-4">Add sets to this folder to start studying!</p>
      <% if (!folder.source_folder_id) { %>
        <a href="/folders/<%= folder.id %>/manage-sets" class="inline-block bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
          <i class="fas fa-plus"></i> Add Sets
        </a>
      <% } %>
    </div>
  <% } else { %>
    <!-- Sets List -->
    <div class="space-y-4">
      <% sets.forEach(set => { %>
        <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition">
          <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3">
            <div class="flex-1">
              <h3 class="text-lg font-bold text-gray-800 mb-1">
                <a href="/sets/<%= set.id %>" class="hover:text-blue-600">
                  <%= set.name %>
                </a>
              </h3>
              <% if (set.description) { %>
                <p class="text-sm text-gray-600 mb-2 line-clamp-2"><%= set.description %></p>
              <% } %>
              <p class="text-xs text-gray-500">
                <i class="fas fa-clock"></i> <%= new Date(set.created_at).toLocaleDateString() %>
              </p>
            </div>
            <div class="flex gap-2">
              <a href="/sets/<%= set.id %>/study" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition text-sm">
                <i class="fas fa-brain"></i> <span class="hidden sm:inline">Study</span>
              </a>
              <a href="/sets/<%= set.id %>" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition text-sm">
                <i class="fas fa-eye"></i> <span class="hidden sm:inline">View</span>
              </a>
            </div>
          </div>
        </div>
      <% }); %>
    </div>
  <% } %>
  </div>
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
